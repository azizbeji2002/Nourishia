{% extends 'base.html.twig' %}

{% block title %}Assign Plan to Patient{% endblock %}

{% block body %}
<div class="container py-4">
    <h1>Assign Plan to {{ patient.name }}</h1>
    
    <div class="row mt-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs" id="assignmentTabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="direct-assign-tab" data-bs-toggle="tab" href="#direct-assign" role="tab" aria-controls="direct-assign" aria-selected="true">
                                <i class="fas fa-bolt"></i> Direct Assignment
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="questionnaire-tab" data-bs-toggle="tab" href="#questionnaire" role="tab" aria-controls="questionnaire" aria-selected="false">
                                <i class="fas fa-clipboard-list"></i> With Questionnaire
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="card-body">
                    <div class="tab-content" id="assignmentTabContent">
                        <!-- Direct Assignment Tab -->
                        <div class="tab-pane fade show active" id="direct-assign" role="tabpanel" aria-labelledby="direct-assign-tab">
                            {{ form_start(form) }}
                                <div class="mb-3">
                                    {{ form_row(form.plan) }}
                                </div>
                                
                                {# Add any additional fields from your form #}
                                
                                <div class="d-grid gap-2 mt-4">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-check-circle"></i> Assign Plan
                                    </button>
                                </div>
                            {{ form_end(form) }}
                        </div>
                        
                        <!-- Questionnaire Tab -->
                        <div class="tab-pane fade" id="questionnaire" role="tabpanel" aria-labelledby="questionnaire-tab">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i> 
                                Send a questionnaire to the patient to gather more information before assigning a plan.
                                This will help you create a more personalized nutritional plan.
                            </div>
                            
                            {{ form_start(form, {'attr': {'id': 'questionnaire-form'}}) }}
                                <input type="hidden" name="send_questionnaire" value="1">
                                
                                <div class="mb-3">
                                    <label for="questionnaire" class="form-label">Select Questionnaire</label>
                                    <select name="questionnaire" id="questionnaire-select" class="form-select" required>
                                        <option value="">Choose a questionnaire...</option>
                                        {% for q in questionnaires %}
                                            <option value="{{ q.id }}">{{ q.title }} ({{ q.questions|length }} questions)</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                
                               
                            
                                
                                <div class="d-grid gap-2 mt-4">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-paper-plane"></i> Send Questionnaire
                                    </button>
                                </div>
                            {{ form_end(form) }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h4>Patient Information</h4>
                </div>
                <div class="card-body">
                    <h5>{{ patient.name }}</h5>
                    {% if patient.email %}
                        <p><strong>Email:</strong> {{ patient.email }}</p>
                    {% endif %}
                    
                    {% if patient.plan %}
                        <hr>
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>Current Plan:</strong> {{ patient.plan }}
                            <p class="small mb-0">Assigning a new plan will replace the current one.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Toggle between tabs
        document.querySelectorAll('#assignmentTabs a').forEach(function(tab) {
            tab.addEventListener('click', function(event) {
                event.preventDefault();
                
                document.querySelectorAll('#assignmentTabs a').forEach(function(t) {
                    t.classList.remove('active');
                    document.querySelector(t.getAttribute('href')).classList.remove('show', 'active');
                });
                
                this.classList.add('active');
                document.querySelector(this.getAttribute('href')).classList.add('show', 'active');
            });
        });
    });
</script>
{% endblock %}